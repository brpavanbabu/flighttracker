name: Daily Flight Update - July-August

on:
  # Run daily at 22:00 (10 PM) UTC
  schedule:
    - cron: '0 22 * * *'
  
  # Allow manual trigger
  workflow_dispatch:

jobs:
  update-flights:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright
          python -m playwright install chromium
          python -m playwright install-deps
      
      - name: Run flight scraper
        run: |
          echo "Scraping flights for July-August 2026..."
          python find_best_3_flights.py > scraper_output.txt 2>&1 || echo "Scraper completed with warnings"
          
          # Show results
          if [ -f best-flights-july-august.json ]; then
            echo "✅ Results found!"
            cat best-flights-july-august.json
          else
            echo "⚠️ No results file created"
          fi
      
      - name: Update website with results
        run: |
          if [ -f best-flights-july-august.json ]; then
            echo "Updating website HTML with scraped data..."
            python update_website.py
          else
            echo "Skipping website update - no data"
          fi
      
      - name: Commit and push if changed
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          
          # Add changes
          git add best-flights-july-august.json index.html || true
          
          # Check if there are changes
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Auto-update: Flight prices for July-August $(date +'%Y-%m-%d %H:%M')"
            git push
            echo "✅ Changes pushed to GitHub"
            echo "Vercel will auto-deploy!"
          fi
      
      - name: Summary
        run: |
          echo "================================"
          echo "Daily Flight Update Complete!"
          echo "================================"
          echo "Time: $(date)"
          echo "Next run: Tomorrow at 22:00 UTC"
          if [ -f best-flights-july-august.json ]; then
            echo "✅ Flight data updated"
          fi
